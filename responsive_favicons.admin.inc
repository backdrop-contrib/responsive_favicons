<?php

/**
 * @file
 * Admin page callbacks for the responsive_favicons module.
 */

/**
 * Menu callback; Provide the administration overview page.
 */
function responsive_favicons_config_page() {
  // TODO add file uploader for files generated by
  // http://realfavicongenerator.net/
  $form['responsive_favicons_path'] = array(
    '#type' => 'textfield',
    '#title' => t('Path to responsive favicon files'),
    '#description' => t('A local file system path where favicon files will be stored. This directory must exist and be writable by Drupal.'),
    '#field_prefix' => file_create_url(variable_get('file_default_scheme', 'public') . '://'),
    '#default_value' => variable_get('responsive_favicons_path', 'favicons'),
  );
  $form['responsive_favicons_tags'] = array(
    '#type' => 'textarea',
    '#title' => t('Favicon tags'),
    '#description' => t('Paste the code provided by <a href="http://realfavicongenerator.net/" target="_blank">http://realfavicongenerator.net/</a>. Make sure each link is on a separate line. It is fine to paste links with paths like "/apple-touch-icon-57x57.png" as these will be converted to the correct paths automatically.'),
    '#default_value' => implode(PHP_EOL, variable_get('responsive_favicons_tags', array())),
    '#rows' => 16,
  );
  $form['responsive_favicons_remove_default'] = array(
    '#type' => 'checkbox',
    '#title' => t('Remove default favicon from Drupal'),
    '#description' => t('It is recommended to remove default favicon as it can cause issues'),
    '#default_value' => variable_get('responsive_favicons_remove_default', 0),
  );

  $form['#submit'][] = 'responsive_favicons_config_page_submit';

  return system_settings_form($form);
}

/**
 * Implements additional submit logic for responsive_favicons_settings_form().
 */
function responsive_favicons_config_page_submit($form, &$form_state) {
  // We want to save tags as an array.
  if (isset($form_state['values']['responsive_favicons_tags'])) {
    variable_set('responsive_favicons_tags', explode(PHP_EOL, $form_state['values']['responsive_favicons_tags']));
    unset($form_state['values']['responsive_favicons_tags']);
  }

  // Remove trailing slash on responsive_favicons_path.
  $form_state['values']['responsive_favicons_path'] = rtrim($form_state['values']['responsive_favicons_path'], '/');
}
